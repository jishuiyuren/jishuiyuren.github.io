<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="jishuiyuren">
    
    
    
    
    
    
    <title>vueå†…éƒ¨è¿è¡Œæœºåˆ¶æºç åˆ†æâ€”â€”åˆå§‹åŒ–å’ŒæŒ‚è½½ | å‰æ°´äºäººéšç¬”</title>
    <!-- inject:style -->
    <link href="/css/style.css" rel="stylesheet" type="text/css">
    <!-- endinject -->
    <style>
        .cube-loading {
            top: 0;
            position: fixed;
            width: 100%;
            height: 100%;
            background: url('/images/lg/loading.gif') no-repeat center center;
            background-color: rgba(0,0,0,.7);
        }

        .cube-loading.out {
            display: none;
        }

        .cube-loading:before {
            display: block;
            content: 'Loading';
            position: relative;
            width: 100%;
            top: 50%;
            right: -50%;
            color: #fff;
        }

        @media(max-width: 768px) {
            .cube-loading:before {
                font-size: 1.2em;
                transform: translate(-24px,20px);
                -webkit-transform: translate(-24px,20px);
                -o-transform: translate(-24px,20px);
                -ms-transform: translate(-24px,20px);
            }
        }

        @media(min-width: 768px) {
            .cube-loading:before {

            }
        }
    </style>
    
</head></html>
<body>
<div class="cube-body">
    <nav id="cube-top-memu" class="cube-menu">
    <ul class="cube-menu-collapse">
        
        <li>
            <i class="cube-icon cube-icon-home" aria-hidden="true"></i>
            <a href="/">ä¸»é¡µ</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-archive" aria-hidden="true"></i>
            <a href="/archives">å½’æ¡£</a>
        </li>
        
    </ul>
</nav>
<nav class="cube-side-menu" id="cube-side-menu">
    <ul class="cube-menu-list">
        
        <li>
            <a class="lrc-control">Open Lyrics</a>
        </li>
        
        <li>
            <a class="scroll-to-top">Top</a>
        </li>
    </ul>
</nav>
    <header class="cube-header" id="cube-header">
    <img src=" http://cube-1252774894.cosgz.myqcloud.com/background.png " alt="å¤´éƒ¨èƒŒæ™¯å›¾ç‰‡">
    
    <div class="cube-type">
        <span class="cube-typed-title">å‰æ°´äºäººçš„ç¬”è®°</span>
        <span class="cube-typed-cursor">|</span>
    </div>
    
</header>

    <style>
        nav.cube-menu:before {
            content: '';
            visibility: hidden;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 44px;
        
            filter: blur(5px);
            -webkit-filter: blur(5px);
        
            z-index: -1;
            background-image: url('/images/bg.jpg');
            background-repeat: no-repeat;
            background-position: center 44px;
            background-size: cover;
            background-color: transparent;
        }

        header.cube-background.cube-header-background {
            visibility: hidden;
            background-image: url('/images/bg.jpg');
            background-position: center 0;
        }
    </style>
    <header class="cube-background cube-header-background">
        
        <div class="cube-type">
            <span class="cube-typed-title">å‰æ°´äºäººçš„ç¬”è®°</span>
            <span class="cube-typed-cursor">|</span>
        </div>
        
    </header>
    <div class="load-header-background"></div>
    <script>
        (function (window) {

            window.headerModule = {}
            window.headerModule.image = {
                width: '2000',
                height: '1414'
            }

        })(window)
    </script>
    
    <div class="cube-content">
        <div class="cube-left">
            <div class="cube-article">
    <h1 class="title">vueå†…éƒ¨è¿è¡Œæœºåˆ¶æºç åˆ†æâ€”â€”åˆå§‹åŒ–å’ŒæŒ‚è½½</h1>
    
    <div class="cube-article-header">
        <div class="cube-article-date">
            <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
            <!-- moment.jså¯¹è±¡ -->
            2019-04-13
        </div>
        <div class="cube-article-tags">
    <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
    
</div>
    </div>
    
    <div class="cube-article-content cube-markdown">
        
        <h3 id="vueå…¨å±€è¿è¡Œæœºåˆ¶"><a href="#vueå…¨å±€è¿è¡Œæœºåˆ¶" class="headerlink" title="vueå…¨å±€è¿è¡Œæœºåˆ¶"></a>vueå…¨å±€è¿è¡Œæœºåˆ¶</h3><p>vueçš„å†…éƒ¨æµç¨‹åˆ†ä¸º5ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>è¿›è¡Œåˆå§‹åŒ–å’ŒæŒ‚è½½ï¼šinitåŠmount</li>
<li>æ¨¡ç‰ˆç¼–è¯‘ï¼šcompileï¼Œç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°render function</li>
<li>è¿›è¡Œå“åº”å¼ä¾èµ–æ”¶é›†ï¼šrender function =&gt; getterã€setter =&gt; watcher è¿›è¡Œ update =&gt; patch çš„è¿‡ç¨‹ä»¥åŠä½¿ç”¨é˜Ÿåˆ—å¼‚æ­¥æ›´æ–°çš„ç­–ç•¥</li>
<li>ä¾èµ–æ”¶é›†çš„åŒæ—¶äº§ç”ŸVirtal DOM ï¼Œrender function è¢«è½¬ä¸ºVNodeèŠ‚ç‚¹</li>
<li>é€šè¿‡diffç®—æ³•è¿›è¡Œpatchæ›´æ–°è§†å›¾</li>
</ol>
<p>åšå®¢æ‹†åˆ†å‡ ç¯‡æ–‡ç« è¿›è¡Œå½’çº³ï¼Œæœ¬ç« è®²è§£ä¸€ä¸‹åˆå§‹åŒ–å’ŒæŒ‚è½½ã€‚<br><a id="more"></a></p>
<h2 id="åˆå§‹åŒ–å’ŒæŒ‚è½½"><a href="#åˆå§‹åŒ–å’ŒæŒ‚è½½" class="headerlink" title="åˆå§‹åŒ–å’ŒæŒ‚è½½"></a>åˆå§‹åŒ–å’ŒæŒ‚è½½</h2><p>åœ¨<code>new Vue()</code>ä¹‹åï¼Œvue è°ƒç”¨ _initå‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œå®ƒä¼šåˆå§‹åŒ–ï¼šç”Ÿå‘½å‘¨æœŸã€äº‹ä»¶ã€propsã€methodsã€dataã€computedå’Œwatchç­‰ã€‚</p>
<p>åˆå§‹åŒ–ä¹‹åè°ƒç”¨$mountæŒ‚è½½ç»„ä»¶ï¼Œå¦‚æœè¿è¡Œæ—¶ç¼–è¯‘ï¼Œä¸å­˜åœ¨render function ä½†æ˜¯å­˜åœ¨templateçš„æƒ…å†µï¼Œä¼šè¿›è¡Œç¼–è¯‘ã€‚</p>
<p>å…¶ä¸­æœ€é‡è¦çš„æ˜¯ä¼šé€šè¿‡Object.definePropertyè®¾ç½®getterå’Œsetterå‡½æ•°ï¼Œç”¨æ¥å®ç°<code>å“åº”å¼</code>å’Œ<code>ä¾èµ–æ”¶é›†</code>ã€‚</p>
<h4 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h4><h4 id="å“åº”å¼ç³»ç»ŸåŸºæœ¬åŸåˆ™"><a href="#å“åº”å¼ç³»ç»ŸåŸºæœ¬åŸåˆ™" class="headerlink" title="å“åº”å¼ç³»ç»ŸåŸºæœ¬åŸåˆ™"></a>å“åº”å¼ç³»ç»ŸåŸºæœ¬åŸåˆ™</h4><p>vue.jsæ˜¯MMVVMæ¡†æ¶ï¼Œæ•°æ®ç»“æœæ˜¯JavaScriptå¯¹è±¡ï¼Œä½†æ˜¯å®ƒèƒ½é€šè¿‡å¯¹è¿™äº›å¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œå½±å“å¯¹åº”å¯¹è§†å›¾ï¼Œå…¶æ ¸å¿ƒå®ç°å°±æ˜¯<code>å“åº”å¼ç³»ç»Ÿ</code>ã€‚<br>ï¼ˆ1ï¼‰Object.defineProperty<br>è®²åˆ°å“åº”å¼ç³»ç»Ÿï¼Œä¸å¯é¿å…è¦è¯´åˆ°<code>Object.defineProperty</code>ï¼ŒVueæ˜¯åŸºäºå®ƒå®ç°å“åº”å¼ç³»ç»Ÿçš„ã€‚</p>
<pre class=" language-bash"><code class="language-bash">
/*
    obj: ç›®æ ‡å¯¹è±¡
    prop: éœ€è¦æ“ä½œçš„ç›®æ ‡å¯¹è±¡çš„å±æ€§å
    descriptor: æè¿°ç¬¦
    <span class="token keyword">return</span> value ä¼ å…¥å¯¹è±¡
*/
Object.defineProperty<span class="token punctuation">(</span>obj, prop, descriptor<span class="token punctuation">)</span>

</code></pre>
<p>descriptorå…·æœ‰ä¸€äº›å±æ€§ï¼š</p>
<ul>
<li>enumerableï¼Œå±æ€§æ˜¯å¦å¯ä»¥æšä¸¾ï¼Œé»˜è®¤false</li>
<li>configurableï¼Œå±æ€§æ˜¯å¦å¯ä»¥è¢«ä¿®æ”¹æˆ–åˆ é™¤ï¼Œé»˜è®¤false</li>
<li>getï¼Œè·å–å±æ€§çš„æ–¹æ³•</li>
<li>setï¼Œè®¾ç½®å±æ€§çš„æ–¹æ³•</li>
</ul>
<p>ï¼ˆ2ï¼‰observerï¼ˆå¯è§‚å¯Ÿçš„ï¼‰</p>
<p>æˆ‘ä»¬çŸ¥é“åœ¨initçš„é˜¶æ®µä¼šè¿›è¡Œåˆå§‹åŒ–ï¼Œä»è€Œå¯¹æ•°æ®è¿›è¡Œ<code>å“åº”åŒ–</code>ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>defineReactive</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šè¿‡<code>Object.defineProperty</code>æ¥å®ç°å¯¹å¯¹è±¡çš„<code>å“åº”åŒ–</code>ï¼Œå…¥å‚æ˜¯ä¸€ä¸ª<code>objï¼ˆéœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼‰</code>ï¼Œ<code>keyï¼ˆobjçš„æŸä¸ªå±æ€§ï¼‰</code>ï¼Œ<code>valï¼ˆå…·ä½“çš„å€¼ï¼‰</code>ã€‚ç»è¿‡<code>defineReactive</code>æ–¹æ³•å¤„ç†åï¼Œobjçš„å±æ€§keyåœ¨<code>ã€Œè¯»ã€</code>çš„æ—¶å€™ä¼šè§¦å‘<code>reactiveGetter</code>æ–¹æ³•ï¼Œè€Œå±æ€§åœ¨ã€Œå†™ã€çš„æ—¶å€™ä¼šè§¦å‘<code>reactiveSetter</code>æ–¹æ³•ã€‚</p>
<pre class=" language-bash"><code class="language-bash"><span class="token keyword">function</span> defineReactive <span class="token punctuation">(</span>obj, key, val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object.defineProperty<span class="token punctuation">(</span>obj, key, <span class="token punctuation">{</span>
        enumerable: true,       /* å±æ€§å¯æšä¸¾ */
        configurable: true,     /* å±æ€§å¯è¢«ä¿®æ”¹æˆ–åˆ é™¤ */
        get: <span class="token keyword">function</span> reactiveGetter <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> val<span class="token punctuation">;</span>         /* å®é™…ä¸Šä¼šä¾èµ–æ”¶é›†ï¼Œä¸‹ä¸€å°èŠ‚ä¼šè®² */
        <span class="token punctuation">}</span>,
        set: <span class="token keyword">function</span> reactiveSetter <span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">==</span><span class="token operator">=</span> val<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            cb<span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

// æ›´æ–°è§†å›¾
<span class="token keyword">function</span> cb <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    /* æ¸²æŸ“è§†å›¾ */
    console.log<span class="token punctuation">(</span><span class="token string">"è§†å›¾æ›´æ–°å•¦ï½"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>å½“ç„¶ï¼Œè¿™åªæ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œè¯¥æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡é€’å½’çš„æ–¹å¼å¯¹æ‰€æœ‰çš„å¯¹è±¡è¿›è¡Œ<code>defineReactive</code>å¤„ç†ã€‚ä¸‹é¢çš„æ–¹æ³•ï¼Œä½¿ç”¨å¾ªç¯çš„æ–¹å¼æ¥å®ç°ä¸€ä¸ª<code>observer</code>çš„é€»è¾‘ã€‚</p>
<pre class=" language-bash"><code class="language-bash"><span class="token keyword">function</span> observer <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value <span class="token operator">||</span> <span class="token punctuation">(</span>typeof value <span class="token operator">!=</span><span class="token operator">=</span> <span class="token string">'object'</span><span class="token punctuation">))</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Object.keys<span class="token punctuation">(</span>value<span class="token punctuation">)</span>.forEach<span class="token punctuation">((</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        defineReactive<span class="token punctuation">(</span>value, key, value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>å“åº”å¼çš„ä¸€ä¸ªå¤§è‡´çš„é€»è¾‘å·²ç»ä»‹ç»å®Œæˆï¼Œæœ€åï¼Œæˆ‘ä»¬æ¥å°†<code>observer</code>å°è£…ä¸ºä¸€ä¸ªVueã€‚åœ¨Vueçš„æ„é€ å‡½æ•°ä¸­ï¼Œå¯¹<code>options</code>çš„<code>data</code>è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œçš„dataå°±æ˜¯æˆ‘ä»¬å¹³æ—¶åœ¨vueç»„ä»¶ä¸­å†™çš„dataå±æ€§ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™é‡Œå½“ä½œä¸€ä¸ªå¯¹è±¡æ¥ç®€å•å¤„ç†ï¼‰ã€‚</p>
<pre class=" language-bash"><code class="language-bash"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>meta http-equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"ie=edge"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>title<span class="token operator">></span>Document<span class="token operator">&lt;</span>/title<span class="token operator">></span>
<span class="token operator">&lt;</span>/head<span class="token operator">></span>
<span class="token operator">&lt;</span>body<span class="token operator">></span>
    <span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">function</span> observer <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value <span class="token operator">||</span> <span class="token punctuation">(</span>typeof value <span class="token operator">!=</span><span class="token operator">=</span> <span class="token string">'object'</span><span class="token punctuation">))</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        Object.keys<span class="token punctuation">(</span>value<span class="token punctuation">)</span>.forEach<span class="token punctuation">((</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            defineReactive<span class="token punctuation">(</span>value, key, value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> cb <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console.log<span class="token punctuation">(</span><span class="token string">"è§†å›¾æ›´æ–°å•¦ï½"</span>, val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> defineReactive <span class="token punctuation">(</span>obj, key, val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object.defineProperty<span class="token punctuation">(</span>obj, key, <span class="token punctuation">{</span>
            enumerable: true,
            configurable: true,
            get: <span class="token keyword">function</span> reactiveGetter <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> val<span class="token punctuation">;</span>         
            <span class="token punctuation">}</span>,
            set: <span class="token keyword">function</span> reactiveSetter <span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">==</span><span class="token operator">=</span> val<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
                cb<span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    class Vue <span class="token punctuation">{</span>
        constructor<span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            this._data <span class="token operator">=</span> options.data<span class="token punctuation">;</span>
            observer<span class="token punctuation">(</span>this._data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> o <span class="token operator">=</span> new Vue<span class="token punctuation">(</span><span class="token punctuation">{</span>
        data: <span class="token punctuation">{</span>
            test: <span class="token string">"I am test."</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    o._data.test <span class="token operator">=</span> <span class="token string">"hello,test."</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span>/script<span class="token operator">></span>
<span class="token operator">&lt;</span>/body<span class="token operator">></span>
<span class="token operator">&lt;</span>/html<span class="token operator">></span>
</code></pre>
<h4 id="ä¾èµ–æ”¶é›†è¿½è¸ªåŸç†"><a href="#ä¾èµ–æ”¶é›†è¿½è¸ªåŸç†" class="headerlink" title="ä¾èµ–æ”¶é›†è¿½è¸ªåŸç†"></a>ä¾èµ–æ”¶é›†è¿½è¸ªåŸç†</h4><p>ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆè¦ä¾èµ–æ”¶é›†ï¼Ÿ<br>ä¸¾ä¸ªğŸŒ°<br>æˆ‘ä»¬ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªå¯¹è±¡ï¼š</p>
<pre class=" language-bash"><code class="language-bash">new Vue<span class="token punctuation">(</span><span class="token punctuation">{</span>
    template: 
        <span class="token variable"><span class="token variable">`</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>text1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/span<span class="token operator">></span> 
            <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>text2<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/span<span class="token operator">></span> 
        <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token variable">`</span></span>,
    data: <span class="token punctuation">{</span>
        text1: <span class="token string">'text1'</span>,
        text2: <span class="token string">'text2'</span>,
        text3: <span class="token string">'text3'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>æˆ‘ä»¬ä¿®æ”¹text3çš„æ•°æ®</p>
<pre class=" language-bash"><code class="language-bash">this.text3 <span class="token operator">=</span> <span class="token string">'modify text3'</span><span class="token punctuation">;</span>
</code></pre>
<p>ä½†æ˜¯å› ä¸ºè§†å›¾ä¸­ä¸éœ€è¦ä½¿ç”¨åˆ°text3ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬ä¸å¯èƒ½å»é€šçŸ¥ä¸Šè¿°æ‰€è®²çš„cbå‡½æ•°å»è¿›è¡Œè§†å›¾çš„ä¿®æ”¹ã€‚</p>
<p>å†ä¸¾ä¸ªğŸŒ°</p>
<p>è¿™æ—¶æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œæœ‰å¤šä¸ªåœ°æ–¹ä½¿ç”¨åˆ°è¯¥å…¨å±€å¯¹è±¡ã€‚</p>
<pre class=" language-bash"><code class="language-bash"><span class="token keyword">let</span> globalObj <span class="token operator">=</span> <span class="token punctuation">{</span>
    text1: <span class="token string">'text1'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> o1 <span class="token operator">=</span> new Vue<span class="token punctuation">(</span><span class="token punctuation">{</span>
    template:
        <span class="token variable"><span class="token variable">`</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>text1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/span<span class="token operator">></span> 
        <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token variable">`</span></span>,
    data: globalObj
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> o2 <span class="token operator">=</span> new Vue<span class="token punctuation">(</span><span class="token punctuation">{</span>
    template:
        <span class="token variable"><span class="token variable">`</span><span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>text1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>/span<span class="token operator">></span> 
        <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token variable">`</span></span>,
    data: globalObj
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>å¦‚æœè¿™æ—¶å€™æˆ‘ä»¬ä¿®æ”¹<code>gloablObj</code>çš„text1çš„å†…å®¹ï¼Œå°±éœ€è¦åŒæ—¶é€šçŸ¥o1å’Œo2ä¸¤ä¸ªå®ä¾‹è¿›è¡Œè§†å›¾çš„æ›´æ–°ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œä¾èµ–æ”¶é›†çš„åŸå› ã€‚</p>
<p>ï¼ˆ2ï¼‰è®¢é˜…è€…<br>æˆ‘ä»¬å®ç°ä¸€ä¸ªè®¢é˜…è€…Depï¼Œç”¨æ¥å­˜æ”¾watcherè§‚å¯Ÿè€…å¯¹è±¡ã€‚</p>
<pre class=" language-bash"><code class="language-bash">class Dep <span class="token punctuation">{</span>
    constructor <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        /* ç”¨æ¥å­˜æ”¾Watcherå¯¹è±¡çš„æ•°ç»„ */
        this.subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    /* åœ¨subsä¸­æ·»åŠ ä¸€ä¸ªWatcherå¯¹è±¡ */
    addSub <span class="token punctuation">(</span>sub<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        this.subs.push<span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    /* é€šçŸ¥æ‰€æœ‰Watcherå¯¹è±¡æ›´æ–°è§†å›¾ */
    notify <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        this.subs.forEach<span class="token punctuation">((</span>sub<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            sub.update<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>ï¼ˆ3ï¼‰è§‚å¯Ÿè€…watcher</p>
<pre class=" language-bash"><code class="language-bash">class Watcher <span class="token punctuation">{</span>
    constructor <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        /* åœ¨newä¸€ä¸ªWatcherå¯¹è±¡æ—¶å°†è¯¥å¯¹è±¡èµ‹å€¼ç»™Dep.targetï¼Œåœ¨getä¸­ä¼šç”¨åˆ° */
        Dep.target <span class="token operator">=</span> this<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    /* æ›´æ–°è§†å›¾çš„æ–¹æ³• */
    update <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console.log<span class="token punctuation">(</span><span class="token string">"è§†å›¾æ›´æ–°å•¦ï½"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Dep.target <span class="token operator">=</span> null<span class="token punctuation">;</span>
</code></pre>
<p>ï¼ˆ4ï¼‰ä¾èµ–æ”¶é›†<br>æˆ‘ä»¬æŠŠä¸Šé¢çš„<code>defineReactive</code>æ–¹æ³•ä¿®æ”¹ï¼Œå¢åŠ ä¸€ä¸ªDepç±»å¯¹è±¡ï¼Œç”¨æ¥æ”¶é›†watcherå¯¹è±¡ã€‚åœ¨å¯¹è±¡è¢«è¯»çš„æ—¶å€™ï¼Œè§¦å‘<code>reactiveGetter</code>å‡½æ•°ï¼ŒæŠŠå½“å‰çš„watcherå¯¹è±¡æ”¶é›†åˆ°Depç±»ä¸­ï¼Œä¹‹åå½“å¯¹è±¡è¢«å†™æ—¶è§¦å‘<code>reactiveSetter</code>æ–¹æ³•ï¼Œé€šçŸ¥Depç±»è°ƒç”¨<code>notify</code>æ¥è§¦å‘Watcherå¯¹è±¡çš„<code>update</code>æ–¹æ³•æ›´æ–°å¯¹åº”çš„è§†å›¾ã€‚</p>
<pre class=" language-bash"><code class="language-bash"><span class="token keyword">function</span> defineReactive <span class="token punctuation">(</span>obj, key, val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    /* ä¸€ä¸ªDepç±»å¯¹è±¡ */
    const dep <span class="token operator">=</span> new Dep<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Object.defineProperty<span class="token punctuation">(</span>obj, key, <span class="token punctuation">{</span>
        enumerable: true,
        configurable: true,
        get: <span class="token keyword">function</span> reactiveGetter <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            /* å°†Dep.targetï¼ˆå³å½“å‰çš„Watcherå¯¹è±¡å­˜å…¥depçš„subsä¸­ï¼‰ */
            dep.addSub<span class="token punctuation">(</span>Dep.target<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> val<span class="token punctuation">;</span>         
        <span class="token punctuation">}</span>,
        set: <span class="token keyword">function</span> reactiveSetter <span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">==</span><span class="token operator">=</span> val<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            /* åœ¨setçš„æ—¶å€™è§¦å‘depçš„notifyæ¥é€šçŸ¥æ‰€æœ‰çš„Watcherå¯¹è±¡æ›´æ–°è§†å›¾ */
            dep.notify<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

class Vue <span class="token punctuation">{</span>
    constructor<span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        this._data <span class="token operator">=</span> options.data<span class="token punctuation">;</span>
        observer<span class="token punctuation">(</span>this._data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        /* æ–°å»ºä¸€ä¸ªWatcherè§‚å¯Ÿè€…å¯¹è±¡ï¼Œè¿™æ—¶å€™Dep.targetä¼šæŒ‡å‘è¿™ä¸ªWatcherå¯¹è±¡ */
        new Watcher<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        /* åœ¨è¿™é‡Œæ¨¡æ‹Ÿrenderçš„è¿‡ç¨‹ï¼Œä¸ºäº†è§¦å‘testå±æ€§çš„getå‡½æ•° */
        console.log<span class="token punctuation">(</span><span class="token string">'render~'</span>, this._data.test<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>åˆ°è¿™é‡Œï¼Œå“åº”å¼ç³»ç»Ÿå’Œä¾èµ–æ”¶é›†å°±è®²å®Œäº†ï¼Œç°åœ¨è¿›è¡Œæ€»ç»“ä¸€ä¸‹ã€‚</p>
<ul>
<li>é¦–å…ˆåœ¨observerçš„è¿‡ç¨‹ä¸­ä¼šæ³¨å†Œgetæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨æ¥è¿›è¡Œã€Œä¾èµ–æ”¶é›†ã€ã€‚</li>
<li>åœ¨å®ƒçš„é—­åŒ…ä¸­ä¼šæœ‰ä¸€ä¸ªDepå¯¹è±¡ï¼Œç”¨è¿™ä¸ªå¯¹è±¡æ¥å­˜æ”¾<code>watcher</code>å¯¹è±¡ï¼Œä¾èµ–æ”¶é›†çš„è¿‡ç¨‹å°±æ˜¯å°†watcherå®ä¾‹å­˜æ”¾åˆ°å¯¹åº”çš„Depå¯¹è±¡ä¸­å»çš„ã€‚</li>
<li>getæ–¹æ³•è®©å½“å‰çš„watcherå¯¹è±¡å­˜æ”¾åˆ°å®ƒçš„<code>subs</code>ï¼ˆaddSubï¼‰ä¸­ã€‚</li>
<li>åœ¨æ•°æ®æ›´æ–°æ—¶ï¼Œsetä¼šè°ƒç”¨Depå¯¹è±¡çš„notifyæ–¹æ³•ï¼Œé€šçŸ¥å®ƒå†…éƒ¨çš„æ‰€æœ‰<code>watcher</code>å¯¹è±¡è¿›è¡Œè§†å›¾æ›´æ–°ã€‚</li>
</ul>

    </div>
</div>

<div class="cube-article-nav">
    <ul>
        
        <li class="prev">
            <a href="/2019/04/14/article17/">
                <i class="cube-icon cube-prev" aria-hidden="true"></i>
                vueå†…éƒ¨è¿è¡Œæœºåˆ¶æºç åˆ†æâ€”â€”æ¨¡ç‰ˆç¼–è¯‘
            </a>
        </li>
        
        
        <li class="next">
            <a href="/2019/04/09/article/">
                åœ°å›¾å‡ºå›¾/æ‰“å°
                <i class="cube-icon cube-next" aria-hidden="true"></i>
            </a>
        </li>
        
    </ul>
</div>


<!-- TODO æ ¹æ®theme.commentçš„å†…å®¹è¿›è¡Œå…¥å£é€‰æ‹© -->



        </div>
        <div class="cube-right">
            
<div class="cube-author cube-sidebar" id="cube-author">
    
    
    <span>jishuiyuren</span>
    
    
    <div class="count">
        <a class="count articles"><span>17</span>Article</a>
        <a class="count tags"><span>3</span>Tags</a>
        <a class="count categories"><span>0</span>Categories</a>
    </div>
</div>



<div class="cube-recent-posts cube-sidebar" id="cube-recent-posts">
    <div class="title">
        <a>Recent Posts</a>
    </div>
    <ul class="list">
        
        
        <li>
            <!-- TODO å¦‚æœæ–‡ç« è¦æ˜¾ç¤ºå›¾ç‰‡ï¼Œé‚£ä¹ˆåœ¨front-matterä¸Šæ·»åŠ previewå±æ€§(url or path) -->
            
            <div class="normal">
                <p class="index first">
                    <span>1</span>
                </p>
                <p class="title">
                    <a href="/2019/04/14/article17/" title="vueå†…éƒ¨è¿è¡Œæœºåˆ¶æºç åˆ†æâ€”â€”æ¨¡ç‰ˆç¼–è¯‘">vueå†…éƒ¨è¿è¡Œæœºåˆ¶æºç åˆ†æâ€”â€”æ¨¡ç‰ˆç¼–è¯‘</a>
                </p>
            </div>
            
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>2</span>
                </p>
                <p class="title">
                    <a href="/2019/04/13/article16/" title="vueå†…éƒ¨è¿è¡Œæœºåˆ¶æºç åˆ†æâ€”â€”åˆå§‹åŒ–å’ŒæŒ‚è½½">vueå†…éƒ¨è¿è¡Œæœºåˆ¶æºç åˆ†æâ€”â€”åˆå§‹åŒ–å’ŒæŒ‚è½½</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>3</span>
                </p>
                <p class="title">
                    <a href="/2019/04/09/article/" title="åœ°å›¾å‡ºå›¾/æ‰“å°">åœ°å›¾å‡ºå›¾/æ‰“å°</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>4</span>
                </p>
                <p class="title">
                    <a href="/2019/04/02/article15/" title="è§†é¢‘æ’­æ”¾è¿›åº¦è®°å½•">è§†é¢‘æ’­æ”¾è¿›åº¦è®°å½•</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>5</span>
                </p>
                <p class="title">
                    <a href="/2019/04/02/article14/" title="å¾®ä¿¡å°ç¨‹åºçš„ä¸Šæ‹‰åŠ è½½åŠŸèƒ½">å¾®ä¿¡å°ç¨‹åºçš„ä¸Šæ‹‰åŠ è½½åŠŸèƒ½</a>
                </p>
            </div>
        </li>
        
        
    </ul>
</div>





<div class="cube-links cube-sidebar" id="cube-links">
    <div class="title">
        <a>Links</a>
    </div>
    <ul class="list">
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/GitHub.png">
            
            <a href="https://github.com/jishuiyuren" target="_blank">å‰æ°´äºäººçš„GitHub</a>
        </li>
        
    </ul>
</div>


        </div>
    </div>
</div>
<footer class="cube-footer">
    
Â© 2017 jishuiyuren

<br>
Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/ZEROKISEKI" target="_blank">AONOSORA</a>
</footer>
<!-- inject:script -->
<script src="/js/script.js"></script>
<!-- endinject -->
<div class="cube-loading out"></div>
</body>
</html>